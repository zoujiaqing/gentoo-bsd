diff -Nur cddl.orig/lib/libzfs/Makefile cddl/lib/libzfs/Makefile
--- cddl.orig/lib/libzfs/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/lib/libzfs/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -55,4 +55,8 @@
 CFLAGS+= -I${.CURDIR}/../../../cddl/contrib/opensolaris/lib/libuutil/common
 CFLAGS+= -I${.CURDIR}/../../../cddl/contrib/opensolaris/lib/libzfs/common
 
+LDFLAGS+= -L${.CURDIR}/../../lib/libnvpair
+LDFLAGS+= -L${.CURDIR}/../../lib/libumem
+LDFLAGS+= -L${.CURDIR}/../../lib/libuutil
+
 .include <bsd.lib.mk>
diff -Nur cddl.orig/lib/libzpool/Makefile cddl/lib/libzpool/Makefile
--- cddl.orig/lib/libzpool/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/lib/libzpool/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -56,6 +56,10 @@
 CFLAGS+=	-I${.CURDIR}/../../../lib/libpthread/sys
 CFLAGS+=	-I${.CURDIR}/../../../lib/libthr/arch/${MACHINE_CPUARCH}/include
 
+LDFLAGS+= -L${.CURDIR}/../../lib/libavl
+LDFLAGS+= -L${.CURDIR}/../../lib/libnvpair
+LDFLAGS+= -L${.CURDIR}/../../lib/libumem
+
 DPADD=		${LIBMD} ${LIBPTHREAD} ${LIBZ}
 LDADD=		-lmd -lpthread -lz
 
diff -Nur cddl.orig/sbin/zfs/Makefile cddl/sbin/zfs/Makefile
--- cddl.orig/sbin/zfs/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/sbin/zfs/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -21,6 +21,11 @@
 CFLAGS+= -I${.CURDIR}/../../../sys/cddl/contrib/opensolaris/uts/common/sys
 CFLAGS+= -I${.CURDIR}/../../../sys/cddl/contrib/opensolaris/common/zfs
 
+LDFLAGS+= -L${.CURDIR}/../../lib/libnvpair
+LDFLAGS+= -L${.CURDIR}/../../lib/libumem
+LDFLAGS+= -L${.CURDIR}/../../lib/libuutil
+LDFLAGS+= -L${.CURDIR}/../../lib/libzfs
+
 DPADD=	${LIBGEOM} ${LIBJAIL} ${LIBNVPAIR} ${LIBUMEM} \
 	${LIBUTIL} ${LIBUUTIL} ${LIBZFS}
 LDADD=	-lgeom -ljail -lnvpair -lumem -lutil -luutil -lzfs
diff -Nur cddl.orig/sbin/zpool/Makefile cddl/sbin/zpool/Makefile
--- cddl.orig/sbin/zpool/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/sbin/zpool/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -26,6 +26,12 @@
 CFLAGS+= -I${.CURDIR}/../../../cddl/contrib/opensolaris/lib/libzpool/common
 CFLAGS+= -I${.CURDIR}/../../../cddl/contrib/opensolaris/cmd/stat/common
 
+LDFLAGS+= -L${.CURDIR}/../../lib/libavl
+LDFLAGS+= -L${.CURDIR}/../../lib/libnvpair
+LDFLAGS+= -L${.CURDIR}/../../lib/libumem
+LDFLAGS+= -L${.CURDIR}/../../lib/libuutil
+LDFLAGS+= -L${.CURDIR}/../../lib/libzfs
+
 DPADD=	${LIBAVL} ${LIBGEOM} ${LIBNVPAIR} \
 	${LIBUMEM} ${LIBUTIL} ${LIBUUTIL} ${LIBZFS}
 LDADD=	-lavl -lgeom -lnvpair -lumem -lutil -luutil -lzfs
diff -Nur cddl.orig/usr.bin/ctfconvert/Makefile cddl/usr.bin/ctfconvert/Makefile
--- cddl.orig/usr.bin/ctfconvert/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/usr.bin/ctfconvert/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -36,6 +36,8 @@
 		-I${OPENSOLARIS_USR_DISTDIR}/tools/ctf/cvt \
 		-I${OPENSOLARIS_SYS_DISTDIR}/uts/common
 
+LDFLAGS+=	-L${.CURDIR}/../../lib/libctf
+
 DPADD=		${LIBCTF} ${LIBDWARF} ${LIBELF} ${LIBZ} ${LIBPTHREAD}
 LDADD=		-lctf -ldwarf -lelf -lz -lpthread
 
diff -Nur cddl.orig/usr.bin/ctfmerge/Makefile cddl/usr.bin/ctfmerge/Makefile
--- cddl.orig/usr.bin/ctfmerge/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/usr.bin/ctfmerge/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -33,6 +33,8 @@
 		-I${OPENSOLARIS_USR_DISTDIR}/tools/ctf/cvt \
 		-I${OPENSOLARIS_SYS_DISTDIR}/uts/common
 
+LDFLAGS+=	-L${.CURDIR}/../../lib/libctf
+
 DPADD=		${LIBCTF} ${LIBDWARF} ${LIBELF} ${LIBZ} ${LIBPTHREAD}
 LDADD=		-lctf -ldwarf -lelf -lz -lpthread
 
diff -Nur cddl.orig/usr.bin/zinject/Makefile cddl/usr.bin/zinject/Makefile
--- cddl.orig/usr.bin/zinject/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/usr.bin/zinject/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -19,6 +19,13 @@
 CFLAGS+= -I${.CURDIR}/../../contrib/opensolaris/head
 CFLAGS+= -I${.CURDIR}/../../lib/libumem
 
+LDFLAGS+= -L${.CURDIR}/../../lib/libavl
+LDFLAGS+= -L${.CURDIR}/../../lib/libnvpair
+LDFLAGS+= -L${.CURDIR}/../../lib/libumem
+LDFLAGS+= -L${.CURDIR}/../../lib/libuutil
+LDFLAGS+= -L${.CURDIR}/../../lib/libzfs
+LDFLAGS+= -L${.CURDIR}/../../lib/libzpool
+
 DPADD=	${LIBGEOM} ${LIBM} ${LIBNVPAIR} ${LIBUMEM} ${LIBUUTIL} \
 	${LIBZFS} ${LIBZPOOL}
 LDADD=	-lgeom -lm -lnvpair -lumem -luutil -lzfs -lzpool
diff -Nur cddl.orig/usr.bin/zstreamdump/Makefile cddl/usr.bin/zstreamdump/Makefile
--- cddl.orig/usr.bin/zstreamdump/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/usr.bin/zstreamdump/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -18,6 +18,11 @@
 CFLAGS+= -I${.CURDIR}/../../contrib/opensolaris/head
 CFLAGS+= -I${.CURDIR}/../../lib/libumem
 
+LDFLAGS+= -L${.CURDIR}/../../lib/libavl
+LDFLAGS+= -L${.CURDIR}/../../lib/libnvpair
+LDFLAGS+= -L${.CURDIR}/../../lib/libumem
+LDFLAGS+= -L${.CURDIR}/../../lib/libzpool
+
 DPADD=	${LIBM} ${LIBNVPAIR} ${LIBUMEM} ${LIBZPOOL} \
 	${LIBPTHREAD} ${LIBZ} ${LIBAVL}
 LDADD=	-lm -lnvpair -lumem -lzpool -lpthread -lz -lavl
diff -Nur cddl.orig/usr.bin/ztest/Makefile cddl/usr.bin/ztest/Makefile
--- cddl.orig/usr.bin/ztest/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/usr.bin/ztest/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -18,6 +18,11 @@
 CFLAGS+= -I${.CURDIR}/../../contrib/opensolaris/head
 CFLAGS+= -I${.CURDIR}/../../lib/libumem
 
+LDFLAGS+= -L${.CURDIR}/../../lib/libavl
+LDFLAGS+= -L${.CURDIR}/../../lib/libnvpair
+LDFLAGS+= -L${.CURDIR}/../../lib/libumem
+LDFLAGS+= -L${.CURDIR}/../../lib/libzpool
+
 DPADD=	${LIBGEOM} ${LIBM} ${LIBNVPAIR} ${LIBUMEM} ${LIBZPOOL} \
 	${LIBPTHREAD} ${LIBAVL} ${LIBZFS} ${LIBUUTIL}
 LDADD=	-lgeom -lm -lnvpair -lumem -lzpool -lpthread -lavl -lzfs -luutil
diff -Nur cddl.orig/usr.sbin/dtrace/Makefile.rej cddl/usr.sbin/dtrace/Makefile.rej
--- cddl.orig/usr.sbin/dtrace/Makefile.rej	1970-01-01 09:00:00.000000000 +0900
+++ cddl/usr.sbin/dtrace/Makefile.rej	2012-12-31 18:31:12.000000000 +0900
@@ -0,0 +1,17 @@
+***************
+*** 20,25 ****
+  #CFLAGS+=	-DNEED_ERRLOC
+  #YFLAGS+=	-d
+  
+  DPADD=		${LIBPTHREAD} ${LIBDTRACE} ${LIBY} ${LIBL} ${LIBPROC} \
+  		${LIBCTF} ${LIBELF} ${LIBZ} ${LIBUTIL} ${LIBRTLD_DB}
+  LDADD=		-lpthread -ldtrace -ly -ll -lproc -lctf -lelf -lz -lutil \
+--- 20,27 ----
+  #CFLAGS+=	-DNEED_ERRLOC
+  #YFLAGS+=	-d
+  
++ LDFLAGS+= -L${.CURDIR}/../../lib/libdtrace -L${.CURDIR}/../../lib/libctf
++ 
+  DPADD=		${LIBPTHREAD} ${LIBDTRACE} ${LIBY} ${LIBL} ${LIBPROC} \
+  		${LIBCTF} ${LIBELF} ${LIBZ} ${LIBUTIL} ${LIBRTLD_DB}
+  LDADD=		-lpthread -ldtrace -ly -ll -lproc -lctf -lelf -lz -lutil \
diff -Nur cddl.orig/usr.sbin/lockstat/Makefile cddl/usr.sbin/lockstat/Makefile
--- cddl.orig/usr.sbin/lockstat/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/usr.sbin/lockstat/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -20,6 +20,8 @@
 
 CFLAGS+=	-DNEED_ERRLOC -g
 
+LDFLAGS+=-L${.CURDIR}/../../lib/libdtrace -L${.CURDIR}/../../lib/libctf
+
 #YFLAGS+=	-d
 
 DPADD=		${LIBPTHREAD} ${LIBDTRACE} ${LIBY} ${LIBFL} ${LIBPROC} \
diff -Nur cddl.orig/usr.sbin/zdb/Makefile cddl/usr.sbin/zdb/Makefile
--- cddl.orig/usr.sbin/zdb/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/usr.sbin/zdb/Makefile	2012-12-31 18:31:12.000000000 +0900
@@ -23,6 +23,13 @@
 CFLAGS+= -I${.CURDIR}/../../../cddl/contrib/opensolaris/head
 CFLAGS+= -I${.CURDIR}/../../lib/libumem
 
+LDFLAGS+= -L${.CURDIR}/../../lib/libavl
+LDFLAGS+= -L${.CURDIR}/../../lib/libnvpair
+LDFLAGS+= -L${.CURDIR}/../../lib/libumem
+LDFLAGS+= -L${.CURDIR}/../../lib/libuutil
+LDFLAGS+= -L${.CURDIR}/../../lib/libzfs
+LDFLAGS+= -L${.CURDIR}/../../lib/libzpool
+
 DPADD=	${LIBGEOM} ${LIBM} ${LIBNVPAIR} ${LIBPTHREAD} ${LIBUMEM} \
 	${LIBUUTIL} ${LIBZFS} ${LIBZPOOL}
 LDADD=	-lgeom -lm -lnvpair -lpthread -lumem -luutil -lzfs -lzpool
diff -Nur cddl.orig/usr.sbin/zhack/Makefile cddl/usr.sbin/zhack/Makefile
--- cddl.orig/usr.sbin/zhack/Makefile	2012-12-31 18:30:35.000000000 +0900
+++ cddl/usr.sbin/zhack/Makefile	2012-12-31 18:32:26.000000000 +0900
@@ -22,6 +22,12 @@
 CFLAGS+= -I${.CURDIR}/../../../cddl/contrib/opensolaris/head
 CFLAGS+= -I${.CURDIR}/../../lib/libumem
 
+LDFLAGS+= -L${.CURDIR}/../../lib/libnvpair
+LDFLAGS+= -L${.CURDIR}/../../lib/libumem
+LDFLAGS+= -L${.CURDIR}/../../lib/libuutil
+LDFLAGS+= -L${.CURDIR}/../../lib/libzfs
+LDFLAGS+= -L${.CURDIR}/../../lib/libzpool
+
 DPADD=	${LIBGEOM} ${LIBM} ${LIBNVPAIR} ${LIBPTHREAD} ${LIBUMEM} \
 	${LIBUUTIL} ${LIBZFS} ${LIBZPOOL}
 LDADD=	-lgeom -lm -lnvpair -lpthread -lumem -luutil -lzfs -lzpool
